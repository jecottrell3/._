#! /bin/sh

mkdir -p ${1?'directory'}
cd $1 || exit 1
mkdir -p .pkgs
yum -v grouplist hidden | 
sed -n '/^   /s/.*(//;s/)//p' |
sort | 
while read group
do
	name=$group			# Normal
	case $group in
	(legacy-*)	;;		# OK
	(*-support)	continue;;	# LANG
	(core)	name=0$group;;		# SPECIAL
	(base)	name=1$group;;		# SPECIAL
	(base-x)name=2$group;;		# SPECIAL
	esac

	echo 1>&2 "=== Group: '$group' ==="
	exec 3>.pkgs/$name
	echo 1>&3 @$group
	mkdir -p $name

	type=
	yum groupinfo $group | 
	while read pkg
	do
		case $pkg in
		(*Mandatory*)	type=M pm=-;;
		(*Default*)	type=d pm=-;;
		(*Optional*)	type=o pm=;;
		(*Conditional*)	type=c pm=?;;
		(*)
			test -n "$type" || continue
			echo 1>&3 "#$type	$pm$pkg"
			echo 1>&2 "=== Package: '$name/$type-$pkg' ==="
			yum info $pkg > $name/$type-$pkg
			;;
		esac
	done
	exec 3>&-
done
